<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flashcards</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'SF Pro Rounded', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: rgba(255, 255, 255, 0.98);
      height: 100vh;
      overflow: hidden;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }

    .header {
      padding: 16px;
      background: rgba(232, 160, 191, 0.15);
      color: #8b5cf6;
      display: flex;
      align-items: center;
      justify-content: space-between;
      -webkit-app-region: drag;
    }

    .title { font-size: 16px; font-weight: 800; }

    .close-btn {
      -webkit-app-region: no-drag;
      background: rgba(232, 160, 191, 0.1);
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      color: #999;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .content { flex: 1; padding: 16px; overflow-y: auto; }

    /* Deck List */
    .deck-item {
      background: #f8fafc;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 12px;
      cursor: pointer;
      border: 1px solid #f1f5f9;
      transition: all 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .deck-item:hover { transform: translateY(-2px); border-color: #c4b5fd; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    .deck-info { font-weight: 700; color: #4a4a5a; }
    .deck-count { font-size: 11px; color: #999; }

    /* New Deck Section */
    .new-deck-area { margin-top: 10px; display: flex; gap: 8px; }
    .input-small { flex: 1; padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 13px; outline: none; }
    .btn-small { padding: 8px 12px; background: #c4b5fd; color: white; border: none; border-radius: 8px; font-size: 12px; font-weight: 700; cursor: pointer; }

    /* Study Cards View */
    #studyView { display: none; height: 100%; flex-direction: column; }
    .back-nav { margin-bottom: 15px; cursor: pointer; color: #8b5cf6; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 4px; }
    
    .flashcard {
      width: 100%; height: 200px; perspective: 1000px; cursor: pointer; margin-bottom: 20px;
    }
    .flashcard-inner {
      position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d;
      border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    }
    .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
    .side {
      position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
      display: flex; align-items: center; justify-content: center; padding: 25px;
      font-size: 18px; font-weight: 600; color: #4a4a5a; text-align: center; border-radius: 16px; background: white;
    }
    .back { transform: rotateY(180deg); background: #fef2f2; color: #e8a0bf; }

    .nav-btns { display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: auto; }
    .circle-btn { width: 44px; height: 44px; border-radius: 50%; border: none; background: #f1f5f9; color: #8b5cf6; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    .circle-btn:disabled { opacity: 0.3; }

    /* Create Card Section */
    .add-card-area { margin-top: 20px; padding-top: 20px; border-top: 1px dotted #e2e8f0; }
    .btn-wide { width: 100%; padding: 10px; background: #faf5ff; border: 1.5px dashed #c4b5fd; border-radius: 10px; color: #8b5cf6; font-size: 13px; font-weight: 700; cursor: pointer; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="header">
    <div class="title">My Flashcards üêª</div>
    <button class="close-btn" id="closeBtn">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
  </div>

  <div class="content">
    <!-- Deck Selector -->
    <div id="deckListView">
      <div id="deckList"></div>
      
      <div class="new-deck-area">
        <input type="text" id="newDeckName" class="input-small" placeholder="New Deck Name...">
        <button class="btn-small" id="createDeckBtn">Add</button>
      </div>
    </div>

    <!-- Study View -->
    <div id="studyView">
      <div class="back-nav" id="backToDecks">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 18l-6-6 6-6"/></svg> All Decks
      </div>

      <div class="flashcard" id="flashcard">
        <div class="flashcard-inner">
          <div class="side front" id="cardFront">Question?</div>
          <div class="side back" id="cardBack">Answer!</div>
        </div>
      </div>

      <div class="nav-btns">
        <button class="circle-btn" id="prevBtn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 18l-6-6 6-6"/></svg></button>
        <span id="progress" style="font-size: 12px; color: #94a3b8; font-weight: 700;">1 / 5</span>
        <button class="circle-btn" id="nextBtn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg></button>
      </div>

      <div class="add-card-area">
        <input type="text" id="manualQ" class="input-small" placeholder="Question..." style="margin-bottom: 5px; width: 100%;">
        <input type="text" id="manualA" class="input-small" placeholder="Answer..." style="margin-bottom: 5px; width: 100%;">
        <button class="btn-wide" id="addCardBtn">+ Manually Add Card</button>
      </div>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    const deckListView = document.getElementById('deckListView');
    const deckList = document.getElementById('deckList');
    const studyView = document.getElementById('studyView');
    const flashcard = document.getElementById('flashcard');
    const cardFront = document.getElementById('cardFront');
    const cardBack = document.getElementById('cardBack');
    const progressText = document.getElementById('progress');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    let allDecks = [];
    let currentDeckIdx = -1;
    let currentCardIdx = 0;

    async function init() {
      const data = await ipcRenderer.invoke('get-flashcards');
      allDecks = data.decks || [];
      renderDecks();
    }

    function renderDecks() {
      deckList.innerHTML = '';
      allDecks.forEach((deck, idx) => {
        const el = document.createElement('div');
        el.className = 'deck-item';
        el.innerHTML = `
          <div>
            <div class="deck-info">${deck.name}</div>
            <div class="deck-count">${deck.cards.length} cards</div>
          </div>
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#94a3b8" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg>
        `;
        el.onclick = () => openDeck(idx);
        deckList.appendChild(el);
      });
    }

    function openDeck(idx) {
      currentDeckIdx = idx;
      currentCardIdx = 0;
      deckListView.style.display = 'none';
      studyView.style.display = 'flex';
      updateCard();
    }

    function updateCard() {
      const deck = allDecks[currentDeckIdx];
      if (!deck || deck.cards.length === 0) {
        cardFront.textContent = "No cards in this deck!";
        cardBack.textContent = "Add some below!";
        progressText.textContent = "0 / 0";
        prevBtn.disabled = nextBtn.disabled = true;
        return;
      }
      const card = deck.cards[currentCardIdx];
      cardFront.textContent = card.question;
      cardBack.textContent = card.answer;
      progressText.textContent = `${currentCardIdx + 1} / ${deck.cards.length}`;
      flashcard.classList.remove('flipped');
      prevBtn.disabled = currentCardIdx === 0;
      nextBtn.disabled = currentCardIdx === deck.cards.length - 1;
    }

    flashcard.onclick = () => flashcard.classList.toggle('flipped');
    prevBtn.onclick = () => { if (currentCardIdx > 0) { currentCardIdx--; updateCard(); } };
    nextBtn.onclick = () => { if (currentCardIdx < allDecks[currentDeckIdx].cards.length - 1) { currentCardIdx++; updateCard(); } };
    
    document.getElementById('backToDecks').onclick = () => {
      studyView.style.display = 'none';
      deckListView.style.display = 'block';
    };

    document.getElementById('closeBtn').onclick = () => window.close();

    document.getElementById('createDeckBtn').onclick = () => {
      const name = document.getElementById('newDeckName').value.trim();
      if (name) {
        allDecks.push({ name, cards: [] });
        document.getElementById('newDeckName').value = '';
        save();
        renderDecks();
      }
    };

    document.getElementById('addCardBtn').onclick = () => {
      const q = document.getElementById('manualQ').value.trim();
      const a = document.getElementById('manualA').value.trim();
      if (q && a) {
        allDecks[currentDeckIdx].cards.push({ question: q, answer: a });
        document.getElementById('manualQ').value = '';
        document.getElementById('manualA').value = '';
        save();
        updateCard();
      }
    };

    function save() {
      ipcRenderer.send('update-flashcards', { decks: allDecks });
    }

    ipcRenderer.on('flashcards-updated', (_, data) => {
      allDecks = data.decks || [];
      renderDecks();
      if (currentDeckIdx !== -1) updateCard();
    });

    init();
  </script>
</body>
</html>
