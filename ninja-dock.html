<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ninja</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      height: 100%;
      background: transparent;
      overflow: hidden;
      cursor: pointer;
    }

    .dock-ninja {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 100px;
    }

    .ninja-head {
      width: 50px;
      height: 50px;
      background: #2d2d2d;
      border-radius: 50%;
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
    }

    .ninja-headband {
      position: absolute;
      top: 16px;
      left: 50%;
      transform: translateX(-50%);
      width: 54px;
      height: 10px;
      background: #f87171;
      border-radius: 3px;
      z-index: 3;
    }

    .ninja-headband::after {
      content: '';
      position: absolute;
      right: -12px;
      top: 1px;
      width: 14px;
      height: 6px;
      background: #f87171;
      border-radius: 0 4px 4px 0;
      transform: rotate(15deg);
    }

    .ninja-headband::before {
      content: '';
      position: absolute;
      right: -18px;
      top: 6px;
      width: 12px;
      height: 5px;
      background: #ef4444;
      border-radius: 0 4px 4px 0;
      transform: rotate(25deg);
    }

    .ninja-eyes {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 4;
    }

    .ninja-eye {
      width: 8px;
      height: 6px;
      background: white;
      border-radius: 50%;
      position: relative;
    }

    .ninja-eye::after {
      content: '';
      width: 4px;
      height: 4px;
      background: #1a1a1a;
      border-radius: 50%;
      position: absolute;
      top: 1px;
      left: 2px;
    }

    .ninja-body {
      width: 36px;
      height: 35px;
      background: #2d2d2d;
      border-radius: 8px 8px 6px 6px;
      position: absolute;
      top: 42px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1;
    }

    .ninja-belt {
      position: absolute;
      top: 58px;
      left: 50%;
      transform: translateX(-50%);
      width: 38px;
      height: 6px;
      background: #8b5cf6;
      border-radius: 2px;
      z-index: 2;
    }

    .ninja-arm-l, .ninja-arm-r {
      width: 10px;
      height: 22px;
      background: #2d2d2d;
      border-radius: 5px;
      position: absolute;
      top: 46px;
      z-index: 0;
    }

    .ninja-arm-l { left: 11px; transform: rotate(10deg); }
    .ninja-arm-r {
      right: 11px;
      transform: rotate(-10deg);
      animation: wave 1.5s ease-in-out infinite;
    }

    @keyframes wave {
      0%, 100% { transform: rotate(-10deg); }
      50% { transform: rotate(-30deg); }
    }

    .ninja-leg-l, .ninja-leg-r {
      width: 12px;
      height: 18px;
      background: #2d2d2d;
      border-radius: 4px 4px 6px 6px;
      position: absolute;
      top: 72px;
      z-index: 0;
    }

    .ninja-leg-l { left: 24px; }
    .ninja-leg-r { right: 24px; }

    /* Idle bounce */
    .dock-ninja {
      animation: idle-bounce 3s ease-in-out infinite;
    }

    @keyframes idle-bounce {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(-3px); }
    }

    /* Distraction speech bubble */
    .speech-bubble {
      display: none;
      position: absolute;
      bottom: 130px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      padding: 10px 14px;
      font-family: 'SF Pro Rounded', -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 12px;
      font-weight: 600;
      color: #4a4a5a;
      width: 200px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      animation: bubble-in 0.3s ease-out;
      z-index: 100;
    }

    .speech-bubble::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 8px solid rgba(255, 255, 255, 0.95);
    }

    @keyframes bubble-in {
      from { opacity: 0; transform: translateX(-50%) translateY(10px) scale(0.9); }
      to { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
    }

    @keyframes bubble-out {
      from { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
      to { opacity: 0; transform: translateX(-50%) translateY(10px) scale(0.9); }
    }

    .speech-bubble.hiding {
      animation: bubble-out 0.3s ease-in forwards;
    }
  </style>
</head>
  <div class="speech-bubble" id="speechBubble"></div>
  <div class="dock-ninja" id="dockNinja" style="display: none;"></div>
  
  <div id="bearContainer" style="position: absolute; bottom: 0; left: 0; width: 120px; height: 120px; cursor: pointer;">
    <video id="idleVideo" src="mov/breathing.mov" loop muted autoplay style="width: 100%; height: 100%; object-fit: contain;"></video>
    <video id="bearVideo" src="mov/talking-bear.mov" loop muted autoplay style="display: none; width: 100%; height: 100%; object-fit: contain;"></video>
    <video id="scratchVideo" src="mov/scratch-head.mov" loop muted autoplay style="display: none; width: 100%; height: 100%; object-fit: contain;"></video>
    <video id="confettiVideo" src="mov/confetti.mov" muted playsinline style="display: none; width: 100%; height: 100%; object-fit: contain;"></video>
    <video id="yawnVideo" src="mov/yawn.mov" muted playsinline style="display: none; width: 100%; height: 100%; object-fit: contain;"></video>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    const bearVideo = document.getElementById('bearVideo');
    const idleVideo = document.getElementById('idleVideo');
    const scratchVideo = document.getElementById('scratchVideo');
    const confettiVideo = document.getElementById('confettiVideo');
    const yawnVideo = document.getElementById('yawnVideo');
    const speechBubble = document.getElementById('speechBubble');
    const bearContainer = document.getElementById('bearContainer');
    let bubbleTimeout = null;

    bearContainer.addEventListener('click', () => {
      ipcRenderer.send('open-ninja-chat');
    });

    bearContainer.addEventListener('mouseenter', () => {
      ipcRenderer.send('set-ignore-mouse-events', false);
    });

    bearContainer.addEventListener('mouseleave', () => {
      ipcRenderer.send('set-ignore-mouse-events', true, { forward: true });
    });

    ipcRenderer.on('ninja-state', (event, state) => {
      idleVideo.style.display = 'none';
      bearVideo.style.display = 'none';
      scratchVideo.style.display = 'none';
      confettiVideo.style.display = 'none';
      yawnVideo.style.display = 'none';
      speechBubble.style.display = 'none';
      if (bubbleTimeout) clearTimeout(bubbleTimeout);

      if (state === 'speaking') {
        bearVideo.style.display = 'block';
      } else if (state === 'listening') {
        scratchVideo.style.display = 'block';
      } else { // idle
        idleVideo.style.display = 'block';
      }
    });

    // Distraction alert — show speech bubble from the bear
    ipcRenderer.on('distraction-alert', (_, message) => {
      if (bubbleTimeout) clearTimeout(bubbleTimeout);
      speechBubble.classList.remove('hiding');
      speechBubble.textContent = message;
      speechBubble.style.display = 'block';

      // Show scratch-head animation during alert
      idleVideo.style.display = 'none';
      bearVideo.style.display = 'none';
      scratchVideo.style.display = 'block';

      bubbleTimeout = setTimeout(() => {
        speechBubble.classList.add('hiding');
        setTimeout(() => {
          speechBubble.style.display = 'none';
          speechBubble.classList.remove('hiding');
          // Return to idle
          scratchVideo.style.display = 'none';
          idleVideo.style.display = 'block';
        }, 300);
      }, 5000);
    });

    ipcRenderer.on('play-confetti', () => {
      idleVideo.style.display = 'none';
      bearVideo.style.display = 'none';
      scratchVideo.style.display = 'none';
      
      confettiVideo.style.display = 'block';
      confettiVideo.currentTime = 0;
      confettiVideo.play();
      
      confettiVideo.onended = () => {
        confettiVideo.style.display = 'none';
        idleVideo.style.display = 'block';
      };
    });

    ipcRenderer.on('play-yawn', () => {
      idleVideo.style.display = 'none';
      bearVideo.style.display = 'none';
      scratchVideo.style.display = 'none';
      confettiVideo.style.display = 'none';
      
      yawnVideo.style.display = 'block';
      yawnVideo.currentTime = 0;
      yawnVideo.play();

      const phrases = [
        "Fantastic work! Stand up and give your legs a good stretch. You’ve earned a break from that chair. I'll keep watch while you're gone!",
        "Time to rest those eyes! Look at something 20 feet away for a bit. Your screen will still be here when you get back, I promise.",
        "Mission accomplished! Now, go grab a glass of water. Hydrated brains think 20% faster, it’s science! Go on, I’m timing you.",
        "That was a heavy lift. Take a deep breath and let your brain reset. No thinking about this project for the next couple minutes. Total mental silence starts... now!",
        "Break time! Why not do a quick victory lap around the room? Get that blood flowing so we can crush the next block even harder!",
        "I watched you stay focused that whole time, impressive! Go grab a quick snack, you've definitely earned the fuel. I’ll be right here.",
        "Ding! Work mode: OFF. Relaxation mode: ON. Go do something that doesn't involve staring at a pixel. Your future self will thank you!",
        "You're making incredible progress. Step away from the desk and just breathe for a moment. Shake out the tension in your shoulders. You were really locked in!",
        "High five! That block is officially in the books. Go recharge your batteries for a few minutes so we can finish this goal strong!",
        "We are so close to the finish line! Take this break to clear your head completely. When you come back, we’re going to knock out that last task together."
      ];
      speechBubble.textContent = phrases[Math.floor(Math.random() * phrases.length)];
      speechBubble.style.display = 'block';
      speechBubble.classList.remove('hiding');

      yawnVideo.onended = () => {
        yawnVideo.style.display = 'none';
        idleVideo.style.display = 'block';
        
        // Hide bubble after video ends (with a slight delay or immediately)
        bubbleTimeout = setTimeout(() => {
          speechBubble.classList.add('hiding');
          setTimeout(() => {
            speechBubble.style.display = 'none';
          }, 300);
        }, 2000);
      };
    });
  </script>
</body>
</html>
